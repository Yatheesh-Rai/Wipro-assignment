#
# definition of Host Group (environment in Chef)
#
define hostgroup{
        hostgroup_name <%= @host_group %>
}

define servicegroup{
	servicegroup_name <%= @service_group %>
}


<% @servers.each do |server| -%>

#
# definition for <%= server['name'] %>
#
define host{
        use                     linux-server
        host_name               <%= server.name %>      ; (ex: es-oracle-extractor)
        hostgroups              <%= @host_group %>          ; (ex: dev)
        address                 <%= server['ipaddress'] %> ; (ex: 10.141.194.172)
}
define service{
	<% if @host_group == 'dev' -%>
        use                     no-notify-service,graphed-service
	<% else -%>
        use                     local-service,graphed-service
	<% end -%>
        service_description     Current load
        check_command           check_nrpe!check_load
        host_name               <%= server.name %>      ; (ex: es-oracle-extractor)
        servicegroups           <%= @service_group %>   ; (ex: g2)
}
<% if @host_group != 'influxdb' -%>
define service{
	<% if @host_group == 'dev' -%>
        use                     no-notify-service,graphed-service
	<% else -%>
        use                     local-service,graphed-service
	<% end -%>
        service_description     Disk usage
        check_command           check_nrpe!check_ngs
        host_name               <%= server.name %>      ; (ex: es-oracle-extractor)
        servicegroups           <%= @service_group %>   ; (ex: g2)
}
define service{
	<% if @host_group == 'dev' -%>
        use                     no-notify-service,graphed-service
	<% else -%>
        use                     local-service,graphed-service
	<% end -%>
        service_description     Current users
        check_command           check_nrpe!check_users
        host_name               <%= server.name %>      ; (ex: es-oracle-extractor)
        servicegroups           <%= @service_group %>   ; (ex: g2)
}
define service{
	<% if @host_group == 'dev' -%>
        use                     no-notify-service,graphed-service
	<% else -%>
        use                     local-service,graphed-service
	<% end -%>
        service_description     Uptime
        check_command           check_nrpe!check_uptime
        host_name               <%= server.name %>      ; (ex: es-oracle-extractor)
        servicegroups           <%= @service_group %>   ; (ex: g2)
}
define service{
        use                     no-notify-service,graphed-service
        service_description     Java Process
        check_command           check_nrpe!check_procs
        host_name               <%= server.name %>      ; (ex: es-oracle-extractor)
        servicegroups           <%= @service_group %>   ; (ex: g2)
}
define service{
	<% if @host_group == 'dev' -%>
        use                     no-notify-service,graphed-service
	<% else -%>
        use                     local-service,graphed-service
	<% end -%>
        service_description     SSH
        check_command           check_ssh
        host_name               <%= server.name %>      ; (ex: es-oracle-extractor)
        servicegroups           <%= @service_group %>   ; (ex: g2)
}
define service{
	<% if @host_group == 'dev' -%>
        use                     no-notify-service,graphed-service
	<% else -%>
        use                     local-service,graphed-service
	<% end -%>
        service_description     PING
        check_command           check_ping!100.0,20%!500.0,60%
        host_name               <%= server.name %>      ; (ex: es-oracle-extractor)
        servicegroups           <%= @service_group %>   ; (ex: g2)
}

	<% if @host_group == 'uat' -%>
define service{
        use                     local-service,graphed-service         ; Name of service template to use
        service_description     HTTP 8443
        check_command           check_http!-p 8443
        host_name               <%= server.name %>      ; (ex: es-oracle-extractor)
        servicegroups           <%= @service_group %>   ; (ex: g2)
}
define service{
        use                     local-service,graphed-service         ; Name of service template to use
        service_description     SSL 8443
        check_command           check_http!-p 8443 -S
        host_name               <%= server.name %>      ; (ex: es-oracle-extractor)
        servicegroups           <%= @service_group %>   ; (ex: g2)
}
	<% end -%>
<% end -%>

<% end -%>
